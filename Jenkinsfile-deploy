pipeline {
    agent any

    triggers {
        pollSCM '* * * * *'
    }
    stages {
        stage('Build') {
            steps {
                sh './gradlew assemble'
            }
        }
        stage('Test') {
            steps {
                sh './gradlew test'
            }
        }
        stage('Build Docker image') {
            steps {
                sh './gradlew docker'
            }
        }
         stage('Push Docker image') {
                    steps {
                             withDockerRegistry(credentialsId: 'secret-private-key-9b38192f-91c0-4789', url: 'https://index.docker.io/v1/') {
                             sh 'docker push daoduchieumta/spring-boot-api-example'
                          }
                    }
                }
        stage('Run docker image and Deploy to local') {
            steps {
                 sh './gradlew dockerRun'
            }
        }
    }
}